<!doctype html>
<html lang="en"><head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Daily EOD Return Predictions</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:#0b0f14; color:#e8eef7; margin:0; padding:2rem; }
  h1 { margin:0 0 1rem 0; font-weight:700; letter-spacing:0.2px; }
  .time { opacity:0.7; margin-bottom:2rem; }
  .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap:1rem; }
  .card { background:#121824; border:1px solid #1c2433; border-radius:16px; padding:1.25rem; box-shadow:0 6px 24px rgba(0,0,0,0.25); }
  .title { font-size:0.95rem; opacity:0.9; margin-bottom:0.25rem; }
  .pred { font-size:2.2rem; font-weight:800; margin:0.5rem 0 0.25rem 0; }
  .meta { opacity:0.7; font-size:0.9rem; }
  .footer { opacity:0.6; font-size:0.85rem; margin-top:2rem; }
  table { width:100%; border-collapse:collapse; margin-top:2rem; }
  th, td { border-bottom:1px solid #1c2433; padding:0.5rem; text-align:left; }
  th { opacity:0.8; }
  .chart-wrap { background:#121824; border:1px solid #1c2433; border-radius:16px; padding:1rem; margin-top:2rem; position: relative; min-height: 1040px; }
  #histChart { width: 100% !important; height: 1040px !important; }
  #newsTooltip {
    position: absolute;
    background: #0f1624;
    border: 1px solid #25324a;
    border-radius: 10px;
    padding: 10px 12px;
    pointer-events: auto;
    box-shadow: 0 8px 24px rgba(0,0,0,0.45);
    max-width: 420px;
    display: none;
    z-index: 10;
  }
  #newsTooltip .date { font-weight: 700; margin-bottom: 6px; opacity: 0.9; }
  #newsTooltip a { color: #9cd1ff; text-decoration: none; }
  #newsTooltip a:hover { text-decoration: underline; }
  #newsTooltip ul { margin: 6px 0 0 1rem; padding: 0; }
  #newsTooltip li { margin: 4px 0; }
</style>
</head>
<body>
  <h1>Daily EOD Return Predictions — SPY</h1>
  <div class="time">Last updated: 2025-10-30 23:20:27 UTC</div>
  <div class="grid">
    
        <div class="card">
          <div class="title">Student A — Normal Resolution (±4%, 0.5%)</div>
          <div class="pred">+0.50%</div>
          <div class="meta">for 2025-10-30 • (cards from latest entries)</div>
        </div>
        
    
        <div class="card">
          <div class="title">Student B — Finer Resolution (±2.5%, 0.1%)</div>
          <div class="pred">-0.40%</div>
          <div class="meta">for 2025-10-30 • (cards from latest entries)</div>
        </div>
        
  </div>

  <div class="chart-wrap">
    <canvas id="histChart"></canvas>
    <div id="newsTooltip"></div>
  </div>

  <table>
    <thead><tr><th>Date</th><th>Student</th><th>Pred (%)</th><th>Actual (%)</th></tr></thead>
    <tbody>
      <tr><td>2025-10-06</td><td>Student A — Normal Resolution (±4%, 0.5%)</td><td>+0.50%</td><td>+0.36%</td></tr>
<tr><td>2025-10-06</td><td>Student B — Finer Resolution (±2.5%, 0.1%)</td><td>+0.40%</td><td>+0.36%</td></tr>
<tr><td>2025-10-07</td><td>Student A — Normal Resolution (±4%, 0.5%)</td><td>+0.50%</td><td>-0.37%</td></tr>
<tr><td>2025-10-07</td><td>Student B — Finer Resolution (±2.5%, 0.1%)</td><td>+0.40%</td><td>-0.37%</td></tr>
<tr><td>2025-10-08</td><td>Student A — Normal Resolution (±4%, 0.5%)</td><td>+0.00%</td><td>+0.60%</td></tr>
<tr><td>2025-10-08</td><td>Student B — Finer Resolution (±2.5%, 0.1%)</td><td>+0.40%</td><td>+0.60%</td></tr>
<tr><td>2025-10-09</td><td>Student A — Normal Resolution (±4%, 0.5%)</td><td>+0.00%</td><td>-0.29%</td></tr>
<tr><td>2025-10-09</td><td>Student B — Finer Resolution (±2.5%, 0.1%)</td><td>+0.20%</td><td>-0.29%</td></tr>
<tr><td>2025-10-10</td><td>Student B — Finer Resolution (±2.5%, 0.1%)</td><td>+0.20%</td><td>-2.70%</td></tr>
<tr><td>2025-10-10</td><td>Student A — Normal Resolution (±4%, 0.5%)</td><td>+0.00%</td><td>-2.70%</td></tr>
<tr><td>2025-10-13</td><td>Student A — Normal Resolution (±4%, 0.5%)</td><td>+0.50%</td><td>+1.53%</td></tr>
<tr><td>2025-10-13</td><td>Student B — Finer Resolution (±2.5%, 0.1%)</td><td>-0.40%</td><td>+1.53%</td></tr>
<tr><td>2025-10-14</td><td>Student A — Normal Resolution (±4%, 0.5%)</td><td>+0.50%</td><td>-0.12%</td></tr>
<tr><td>2025-10-14</td><td>Student B — Finer Resolution (±2.5%, 0.1%)</td><td>-0.40%</td><td>-0.12%</td></tr>
<tr><td>2025-10-15</td><td>Student A — Normal Resolution (±4%, 0.5%)</td><td>+0.50%</td><td>+0.44%</td></tr>
<tr><td>2025-10-15</td><td>Student B — Finer Resolution (±2.5%, 0.1%)</td><td>+0.80%</td><td>+0.44%</td></tr>
<tr><td>2025-10-16</td><td>Student B — Finer Resolution (±2.5%, 0.1%)</td><td>-0.40%</td><td>-0.68%</td></tr>
<tr><td>2025-10-16</td><td>Student A — Normal Resolution (±4%, 0.5%)</td><td>-0.50%</td><td>-0.68%</td></tr>
<tr><td>2025-10-17</td><td>Student B — Finer Resolution (±2.5%, 0.1%)</td><td>+0.40%</td><td>+0.57%</td></tr>
<tr><td>2025-10-17</td><td>Student A — Normal Resolution (±4%, 0.5%)</td><td>+1.00%</td><td>+0.57%</td></tr>
<tr><td>2025-10-20</td><td>Student A — Normal Resolution (±4%, 0.5%)</td><td>-0.50%</td><td>+1.04%</td></tr>
<tr><td>2025-10-20</td><td>Student B — Finer Resolution (±2.5%, 0.1%)</td><td>-0.40%</td><td>+1.04%</td></tr>
<tr><td>2025-10-21</td><td>Student A — Normal Resolution (±4%, 0.5%)</td><td>-0.50%</td><td>-0.00%</td></tr>
<tr><td>2025-10-21</td><td>Student B — Finer Resolution (±2.5%, 0.1%)</td><td>-0.10%</td><td>-0.00%</td></tr>
<tr><td>2025-10-22</td><td>Student A — Normal Resolution (±4%, 0.5%)</td><td>+0.50%</td><td>-0.52%</td></tr>
<tr><td>2025-10-22</td><td>Student B — Finer Resolution (±2.5%, 0.1%)</td><td>-0.10%</td><td>-0.52%</td></tr>
<tr><td>2025-10-23</td><td>Student A — Normal Resolution (±4%, 0.5%)</td><td>+1.00%</td><td>+0.59%</td></tr>
<tr><td>2025-10-23</td><td>Student B — Finer Resolution (±2.5%, 0.1%)</td><td>+0.40%</td><td>+0.59%</td></tr>
<tr><td>2025-10-24</td><td>Student B — Finer Resolution (±2.5%, 0.1%)</td><td>-0.40%</td><td>+0.82%</td></tr>
<tr><td>2025-10-24</td><td>Student A — Normal Resolution (±4%, 0.5%)</td><td>+0.00%</td><td>+0.82%</td></tr>
<tr><td>2025-10-27</td><td>Student A — Normal Resolution (±4%, 0.5%)</td><td>+0.50%</td><td>+1.18%</td></tr>
<tr><td>2025-10-27</td><td>Student B — Finer Resolution (±2.5%, 0.1%)</td><td>+0.40%</td><td>+1.18%</td></tr>
<tr><td>2025-10-28</td><td>Student A — Normal Resolution (±4%, 0.5%)</td><td>+0.50%</td><td>+0.27%</td></tr>
<tr><td>2025-10-28</td><td>Student B — Finer Resolution (±2.5%, 0.1%)</td><td>+0.20%</td><td>+0.27%</td></tr>
<tr><td>2025-10-29</td><td>Student A — Normal Resolution (±4%, 0.5%)</td><td>+0.50%</td><td>+0.05%</td></tr>
<tr><td>2025-10-29</td><td>Student B — Finer Resolution (±2.5%, 0.1%)</td><td>+0.40%</td><td>+0.05%</td></tr>
<tr><td>2025-10-30</td><td>Student A — Normal Resolution (±4%, 0.5%)</td><td>+0.50%</td><td>-1.10%</td></tr>
<tr><td>2025-10-30</td><td>Student B — Finer Resolution (±2.5%, 0.1%)</td><td>-0.40%</td><td>-1.10%</td></tr>
    </tbody>
  </table>

  <div class="footer">Predictions ~12:00 UTC; Actuals filled ~23:00 UTC (post close). Hover the "Actual" line for clickable top-3 Yahoo Finance headlines.</div>

<script>
const newsMap = {"2025-10-24": [{"title": "Stocks fly to fresh records after tame inflation report", "link": "https://finance.yahoo.com/news/live/stock-market-today-dow-sp-500-nasdaq-surge-to-records-as-tame-inflation-cements-fed-rate-cut-bets-200014567.html"}, {"title": "Trump tariffs panned by Bernanke, Yellen in Supreme Court filing", "link": "https://finance.yahoo.com/news/trump-tariffs-panned-bernanke-yellen-184211358.html"}], "2025-10-27": [{"title": "Tesla chair pleads with investors: Back Musk's $1T pay plan", "link": "https://finance.yahoo.com/news/tesla-may-lose-elon-musk-if-shareholders-dont-approve-1-trillion-pay-package-chairperson-warns-143908548.html"}, {"title": "Flight delays pile up as shutdown eyes longest in history", "link": "https://finance.yahoo.com/news/live/government-shutdown-live-airport-delays-pile-up-as-lawmakers-return-to-dc-with-stoppage-nearing-a-full-month-100414997.html"}], "2025-10-28": [{"title": "US stock futures flat with Fed decision, Big Tech earnings on deck", "link": "https://finance.yahoo.com/news/live/stock-market-today-dow-sp-500-nasdaq-futures-flat-with-fed-decision-slew-of-big-tech-earnings-on-deck-225431419.html"}, {"title": "Nvidia shines, nears $5T value after flurry of moves at GTC", "link": "https://finance.yahoo.com/news/nvidia-stock-hits-all-time-high-nears-5-trillion-market-cap-after-slew-of-updates-at-gtc-event-200333851.html"}], "2025-10-29": [{"title": "Fed cuts rates, Powell leaves December move up in the air", "link": "https://finance.yahoo.com/news/federal-reserve-cuts-interest-rates-by-025-for-second-straight-meeting-2-officials-vote-against-move-as-shutdown-challenges-mount-143206541.html"}, {"title": "Microsoft beats on earnings as cloud shines, but stock tumbles", "link": "https://finance.yahoo.com/news/microsoft-tops-q1-expectations-as-cloud-shines-but-stock-tumbles-151933788.html"}], "2025-10-30": [{"title": "Amazon stock soars on big earnings beat, AWS growth", "link": "https://finance.yahoo.com/news/amazon-q3-earnings-beat-on-top-and-bottom-lines-as-aws-growth-sends-stock-higher-155934360.html"}, {"title": "Netflix announces 10-for-1 stock split", "link": "https://finance.yahoo.com/news/netflix-announces-10-for-1-stock-split-as-company-aims-to-make-stock-more-accessible-for-employees-204922842.html"}]};  // date -> [{title, link}, ...]

const ctx = document.getElementById('histChart').getContext('2d');
const tooltipEl = document.getElementById('newsTooltip');

// sticky hide logic (only hide after leaving BOTH canvas & tooltip for 1.5s)
let hideTimer = null;
const HIDE_DELAY_MS = 1500;
function cancelHide() { if (hideTimer) { clearTimeout(hideTimer); hideTimer = null; } }
function scheduleHide() { cancelHide(); hideTimer = setTimeout(() => { tooltipEl.style.display = 'none'; }, HIDE_DELAY_MS); }
function hideTooltipNow() { cancelHide(); tooltipEl.style.display = 'none'; }

// clamp tooltip within chart container
function showTooltip(html, x, y, container) {
  cancelHide();
  tooltipEl.innerHTML = html;
  tooltipEl.style.display = 'block';
  tooltipEl.style.left = x + 'px';
  tooltipEl.style.top = y + 'px';

  const ttRect = tooltipEl.getBoundingClientRect();
  const contRect = container.getBoundingClientRect();
  const margin = 12;
  let left = x, top = y;

  if (left + ttRect.width + margin > contRect.width) left = contRect.width - ttRect.width - margin;
  if (left < margin) left = margin;
  if (top + ttRect.height + margin > contRect.height) top = contRect.height - ttRect.height - margin;
  if (top < margin) top = margin;

  tooltipEl.style.left = left + 'px';
  tooltipEl.style.top  = top  + 'px';
}
tooltipEl.addEventListener('mouseenter', () => cancelHide());
tooltipEl.addEventListener('mouseleave', () => scheduleHide());

// colors
const colorA  = '#4cc9f0';
const colorB  = '#f72585';
const colorAct = '#e2e8f0';
const gridCol = 'rgba(226, 232, 240, 0.12)';
const tickCol = 'rgba(226, 232, 240, 0.75)';

const chart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: ['2025-10-06','2025-10-07','2025-10-08','2025-10-09','2025-10-10','2025-10-13','2025-10-14','2025-10-15','2025-10-16','2025-10-17','2025-10-20','2025-10-21','2025-10-22','2025-10-23','2025-10-24','2025-10-27','2025-10-28','2025-10-29','2025-10-30'],
    datasets: [
      {
        label: 'Student A — Normal',
        data: [0.5000,0.5000,0.0000,0.0000,0.0000,0.5000,0.5000,0.5000,-0.5000,1.0000,-0.5000,-0.5000,0.5000,1.0000,0.0000,0.5000,0.5000,0.5000,0.5000],
        borderColor: colorA,
        backgroundColor: colorA,
        pointBackgroundColor: colorA,
        pointBorderColor: colorA,
        borderWidth: 2,
        pointRadius: 3,
        pointHoverRadius: 5,
        tension: 0.2
      },
      {
        label: 'Student B — Finer',
        data: [0.4000,0.4000,0.4000,0.2000,0.2000,-0.4000,-0.4000,0.8000,-0.4000,0.4000,-0.4000,-0.1000,-0.1000,0.4000,-0.4000,0.4000,0.2000,0.4000,-0.4000],
        borderColor: colorB,
        backgroundColor: colorB,
        pointBackgroundColor: colorB,
        pointBorderColor: colorB,
        borderWidth: 2,
        pointRadius: 3,
        pointHoverRadius: 5,
        tension: 0.2
      },
      {
        label: 'Actual',
        data: [0.3600,-0.3700,0.6000,-0.2897,-2.7028,1.5344,-0.1222,0.4440,-0.6810,0.5676,1.0400,-0.0015,-0.5199,0.5930,0.8173,1.1798,0.2656,0.0480,-1.0998],
        borderColor: colorAct,
        backgroundColor: colorAct,
        pointBackgroundColor: colorAct,
        pointBorderColor: colorAct,
        borderDash: [6,4],
        borderWidth: 2,
        pointRadius: 3,
        pointHoverRadius: 6,
        tension: 0.2
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    interaction: { mode: 'nearest', intersect: false },
    scales: {
      x: {
        ticks: { color: tickCol },
        grid:  { color: gridCol }
      },
      y: {
        ticks: { color: tickCol },
        grid:  { color: gridCol },
        title: { display: true, text: 'Return (%)', color: tickCol }
      }
    },
    plugins: {
      legend: {
        labels: { color: tickCol }
      },
      tooltip: {
        enabled: false,  // use our HTML tooltip
        external: function(context) {
          const tooltip = context.tooltip;
          const containerNode = context.chart.canvas.parentNode;

          // Let mouseleave handlers decide when to hide
          if (!tooltip || tooltip.opacity === 0) return;

          const dp = tooltip.dataPoints && tooltip.dataPoints[0];
          if (!dp) return;

          // Only for "Actual"
          const dsLabel = dp.dataset.label || '';
          if (dsLabel !== 'Actual') return;

          const labelDate = dp.label;
          const items = newsMap[labelDate] || [];
          if (items.length === 0) return;

          let html = '<div class="date">' + labelDate + ' — Top News</div><ul>';
          for (const it of items) {
            const safeTitle = (it.title || '').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            const safeLink  = (it.link  || '#').replace(/"/g, '&quot;');
            html += '<li><a href="' + safeLink + '" target="_blank" rel="noopener noreferrer">' + safeTitle + '</a></li>';
          }
          html += '</ul>';

          const canvasRect = context.chart.canvas.getBoundingClientRect();
          const containerRect = containerNode.getBoundingClientRect();
          const x = tooltip.caretX + (canvasRect.left - containerRect.left) + 12;
          const y = tooltip.caretY + (canvasRect.top  - containerRect.top)  + 12;

          showTooltip(html, x, y, containerNode);
        }
      }
    },
    onHover: (evt) => {
      const point = chart.getElementsAtEventForMode(evt, 'nearest', { intersect: false }, false)[0];
      if (point && chart.data.datasets[point.datasetIndex].label === 'Actual') {
        evt.native.target.style.cursor = 'pointer';
        cancelHide(); // hovering canvas; keep tooltip open
      } else {
        evt.native.target.style.cursor = 'default';
        // do NOT schedule hide here; user may be moving toward the tooltip
      }
    }
  }
});

// Only schedule hide when leaving the canvas (tooltip handles itself)
chart.canvas.addEventListener('mouseleave', () => scheduleHide());
chart.canvas.addEventListener('mouseenter', () => cancelHide());

// Optional tidy-ups
window.addEventListener('scroll', () => scheduleHide());
window.addEventListener('resize', () => scheduleHide());
</script>
</body></html>
